# 第二章 TCP/IP基础知识

### 一、TCP/IP的诞生

最初的通信技术是由一家以美国国防部（DoD， The Department of Defense）为中心的组织展开研究。到20世纪60年代后半叶，已有大量研究人员投身于分组交换技术和分组通信的研究。

1969年，连接了美国西海岸四所大学和研究所的ARPANET诞生，成为了全球互联网的鼻祖。在之后3年内，ARPANET从4个节点发展成为34个节点的超大网络。

20世纪70年代前半叶，ARPANET中一个研究机构发出了TCP/IP；1982年确定了TCP/IP的具体规范，并于1983年成为ARPANET网络唯一指定的协议。

### 二、TCP/IP的标准化

从字面上看，TCP/IP是指TCP与IP两种协议。在很多情况下，它只是利用IP进行通信时必须用到的协议群的统称，所以也称TCP/IP为网际协议族。

协议类型|协议
:---:|:---:
应用协议 | HTTP, SMTP, FTP, TELNET, SNMP
传输协议 | TCP, UDP
路由控制协议 | RIP, OSPF, BGP
网际协议 | IP, ICMP, ARP

TCP/IP协议的标准化过程具有两大特点：开放性、注重实用性。主要体现在：一个允许任何人加入进行讨论的组织IETF讨论制定了TCP/IP；在制定过程中，首要任务是实现真正能够实现通信的技术。

经过IEFT讨论制定的TCP/IP协议，被人们列入RFC（Request For Comment）文档并在互联网上公布，RFC记录了协议规范内容、协议的实现和运用的相关信息、实验方面的信息等。每一次进行修改都会产生新的RFC编号，并且通过STD编号管理具体协议。

### 三、互联网基础知识
互联网，英文单词为”Internet“，本意为网际网，即将多个网络连接使其构成一个更大的网络。将两个以太网网段用路由器相连是互联网。

互联网的协议就是TCP/IP。

互联网中每个网络都是由骨干网（BackBone）和末端网（Stub）组成的，每个网络之间通过NOC（Network Operation Center，网络操作中心）相连。

### 四、TCP/IP协议分层模型
OSI参考模型（七层）

层数 | 分层名称
:---: | :---:
7 | 应用层
6 | 表示层
5 | 会话层
4 | 传输层
3 | 网络层
2 | 数据链路层
1 | 物理层

TCP/IP分层模型（五层）

层数 | 分层名称 | 对应OSI层数
:---: | :---: | :---:
5 | 应用层 | 5-7
4 | 传输层 | 3-4
3 | 互联网层 | 3
2 | 网卡层 | 2
1 | 硬件 | 1


下面了解TCP/IP分层模型各层的定义与作用

1、 硬件（物理层）

该层是TCP/IP的最底层，负责数据传输。这里的硬件相当于以太网或电话线路等物理层的设备。

2、 网络接口层（数据链路层）

网络接口层利用以太网中的数据链路层进行通信，因此属于接口层。

3、 互联网层（网络层）

互联网曾使用IP协议，IP协议基于IP地址转发分包数据，IP协议的作用是将分组数据发送到目的主机。

4、 传输层

传输层与OSI参考模型的传输层类似，最主要的功能就是能够让应用程序之间实现通信，有两个具有代表性的协议：TCP和UDP。

- TCP是一种面向连接的传输层协议，可以保证两端通信主机之间的通信可达。

- UDP是一种面向无连接的传输层协议，不关注对端是否收到了传送过去的数据。常用于分组数据较少或多播、广播通信记忆视频通信等多媒体领域。

5、 应用层（会话层以上的分层）

TCP/IP协议的应用层将OSI参考模型中的会话层、表示层和应用层的功能能都集中到了应用程序中实现。

- WWW中浏览器与服务端之间通信所用的协议是HTTP（HyperText Transfer Protocol），传输数据的主要格式是HTML（HyperText Markup Language），而HTTP属于OSI中应用层的协议，HTML属于表示层的协议。

- 电子邮件所用的协议叫做SMTP（Simple Mail Transfer Protocol）,电子邮件的格式由MIME协议扩展以后，可以发送声音、图像等信息，这里的MIME属于OSI中的表示层。

### 五、TCP/IP通信示例

1、 数据包首部

每一个分层中，都会对发送的数据附加一个首部，在这个首部中包含了该层的必要信息，如发送的目标地址以及协议相关信息。

| | | | | 归属（除去首部以外） |
 :---: | :---: | :---: | :---: | :---:
以太网包首部 | (IP包首部) | (TCP包首部) | (数据) | 以太网数据
—— | IP包首部 | (TCP包首部) | (数据) | IP中的数据
—— | —— |TCP包首部 | 数据 | TCP中的数据

一般用包、帧、数据报、段、消息表述数据。其中包是全能性术语；帧用于表示数据链路层中包的单位；数据报是IP和UDP等网络层以上的分层中包的单位；段表示TCP数据流中的信息；消息是指应用协议中数据的单位。

2、 发送数据包流程

甲给乙发电子邮件，甲发送后等待乙接收。

- 乙接收电子邮件，建立TCP连接，数据利用TCP进行发送，这种何时建立何时建立连接的功能属于OSI参考模型中会话层的功能，首先使用数据发送给下一层的TCP。

- TCP得到应用层数据后在前端附加一个TCP首部，包含了源端口号和目标端口号、序号以及校验和，再将包发送给IP。

- IP得到包含了TCP首部的数据，再在前端加上IP首部，包含接收端IP地址和发送端IP地址，IP包生成后，参考路由控制表数据开始发送。

- 以太网收到IP包后附上以太网首部通过物理层将以太网数据包传输给接收端。

- 接收端主机收到以太网包，从以太网包首部找到MAC地址判断是否为发送给自己的包，如果不是则丢弃，否则去掉首部得到IP包，发送给IP模块。

- IP模块收到IP包后做类似的处理，向TCP模块发送TCP包。

- TCP收到TCP包后计算校验和，判断数据是否被破坏，然后检查是否按照序号接收数据，最后检查端口号。接着会发送一个“确认回执”给发送端。

- 接收端应用程序收到发送端发送的数据，通过解析数据可以得到邮件的收件人地址，若存在该收件人地址，则保存到主机的硬盘上，并且返回是否成功发送给接收端的回执。
